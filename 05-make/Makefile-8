# Makefile to compile main.c with the specified compiler, 
# flags, sources, sanitizers, and analysis

# Check if CC is set to cc (the default); if so, override it to gcc
ifeq ($(CC),cc)
    CC = gcc
endif

CFLAGS = -Wall -Wextra -Werror
SANITIZERS = -fsanitize=address -fsanitize=undefined -fsanitize=leak
SOURCES = main.c
BINARY = hello
REPORT_DIR = scan-results
CHECKER_REPORT_FILE = cppchecher-report.txt

ifeq ($(CC), gcc)
	ANALYSIS_FLAGS = -fanalyzer
	ANALYZER = 
	ANALYZER_FLAGS =
else ifeq ($(CC), clang)
	ANALYSIS_FLAGS = --analyze
	ANALYZER = scan-build
	ANALYZER_FLAGS = -plist-html -o $(REPORT_DIR)
endif

$(BINARY): $(SOURCES)
	$(CC) $(CFLAGS) $(SANITIZERS) -o $(BINARY) $(SOURCES)

analyze:
	$(ANALYZER) $(ANALYZER_FLAGS) $(CC) $(CFLAGS) $(ANALYSIS_FLAGS) $(SOURCES) -c

cppcheck:
	cppcheck --enable=all --inconclusive --suppress=missingIncludeSystem --checkers-report=$(CHECKER_REPORT_FILE) --quiet $(SOURCES)

# Clean target to remove the compiled executable
clean:
	rm -f $(BINARY)
	rm -f $(CHECKER_REPORT_FILE)
	rm -rf $(REPORT_DIR)
	find . -name '*.plist' -delete
	find . -name '*.o' -delete
