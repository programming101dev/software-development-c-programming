CC = gcc
CFLAGS = -Wall -Wextra -Werror
SOURCES = main.c
BINARY = hello

# Attempt to compile with each sanitizer to check support
CHECK_SANITIZER = \
	$(shell echo "int main(){}" > sanitizer_check.c; \
	if $(CC) $(1) sanitizer_check.c -o /dev/null > /dev/null 2>&1; then echo $(1); fi; \
	rm -f sanitizer_check.c)

SUPPORTED_SANITIZERS += $(call CHECK_SANITIZER,-fsanitize=address)
SUPPORTED_SANITIZERS += $(call CHECK_SANITIZER,-fsanitize=undefined)
SUPPORTED_SANITIZERS += $(call CHECK_SANITIZER,-fsanitize=leak)

$(BINARY): $(SOURCES)
	$(CC) $(CFLAGS) $(SUPPORTED_SANITIZERS) -o $(BINARY) $(SOURCES)

clean:
	rm -f $(BINARY)

